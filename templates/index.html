<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>图片上传器 (端口: 5555)</title>
    <style>
      /* ... 样式代码 ... */
      body {
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 50px;
      }
      #drop-area {
        border: 2px dashed #ccc;
        border-radius: 20px;
        width: 400px;
        height: 200px;
        text-align: center;
        line-height: 200px;
        font-size: 1.2em;
        margin-bottom: 20px;
        cursor: pointer;
      }
      #drop-area.highlight {
        border-color: purple;
      }
      #result {
        margin-top: 20px;
        padding: 10px;
        border: 1px solid #eee;
        min-height: 50px;
      }
      .url-link {
        color: blue;
        text-decoration: underline;
        cursor: copy;
      }
    </style>
  </head>
  <body>
    <h2>图片上传 (拖拽或粘贴)</h2>

    <div id="drop-area">拖拽图片到此处 或 Ctrl+V 粘贴</div>

    <div id="result">等待上传...</div>

    <script>
      const dropArea = document.getElementById("drop-area");
      const resultDiv = document.getElementById("result");

      function uploadFile(file) {
        if (!file.type.startsWith("image/")) {
          resultDiv.innerHTML = "<strong>错误:</strong> 只允许上传图片文件。";
          return;
        }

        resultDiv.innerHTML = "正在上传 " + file.name + "...";

        const formData = new FormData();
        formData.append("file", file);

        fetch("/upload", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              const link = `<a href="${data.url}" target="_blank" class="url-link">${data.url}</a>`;
              resultDiv.innerHTML = `
                        <strong>✅ 上传成功！</strong><br>
                        ZIP 文件名: ${data.filename}<br>
                        图片链接 (24小时内有效): ${link} 
                        <span style="color: green; cursor:pointer;" onclick="navigator.clipboard.writeText('${data.url}')">(点击复制链接)</span>
                    `;
            } else {
              resultDiv.innerHTML = `<strong>❌ 上传失败:</strong> ${data.error}`;
            }
          })
          .catch((error) => {
            resultDiv.innerHTML = `<strong>❌ 网络错误:</strong> ${error}`;
          });
      }

      // --- 拖拽 (Drag & Drop) 和 粘贴 (Ctrl+V Paste) 逻辑 (同前) ---

      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        dropArea.addEventListener(eventName, preventDefaults, false);
      });

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      ["dragenter", "dragover"].forEach((eventName) => {
        dropArea.addEventListener(
          eventName,
          () => dropArea.classList.add("highlight"),
          false
        );
      });

      ["dragleave", "drop"].forEach((eventName) => {
        dropArea.addEventListener(
          eventName,
          () => dropArea.classList.remove("highlight"),
          false
        );
      });

      dropArea.addEventListener("drop", handleDrop, false);

      function handleDrop(e) {
        let dt = e.dataTransfer;
        let files = dt.files;

        if (files.length > 0) {
          uploadFile(files[0]);
        }
      }

      document.addEventListener("paste", handlePaste);

      function handlePaste(e) {
        for (let i = 0; i < e.clipboardData.items.length; i++) {
          const item = e.clipboardData.items[i];
          if (item.kind === "file" && item.type.startsWith("image/")) {
            const file = item.getAsFile();
            uploadFile(file);
            e.preventDefault();
            return;
          }
        }
      }

      dropArea.addEventListener("click", () => {
        const fileInput = document.createElement("input");
        fileInput.type = "file";
        fileInput.accept = "image/*";
        fileInput.onchange = (e) => {
          if (e.target.files.length > 0) {
            uploadFile(e.target.files[0]);
          }
        };
        fileInput.click();
      });
    </script>
  </body>
</html>
